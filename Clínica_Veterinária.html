<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Vet Clinic Completa</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .box { padding: 15px; border: 2px solid; margin-bottom: 15px; border-radius: 8px; }
        .verde { border-color: #28a745; background-color: #f0fff4; }
        .amarelo { border-color: #ffc107; background-color: #fff3cd; }
        .roxo { border-color: #6f42c1; background-color: #f3e5f5; }
        h3 { margin-top: 0; }
    </style>
</head>
<body>
    <h1>üêæ Cl√≠nica Veterin√°ria (Completa)</h1>

    <div class="box verde">
        <h3>1. Criar Ficha (Cadastro)</h3>
        <input id="cadNome" placeholder="Nome do Pet">
        <select id="cadTipo" onchange="mudarOpcaoExtra()">
            <option value="cao">Cachorro</option>
            <option value="gato">Gato</option>
        </select>
        <select id="cadExtra">
            <option value="P">Porte Pequeno</option>
            <option value="G">Porte Grande</option>
        </select>
        <button onclick="cadastrarFicha()">Salvar Ficha</button>
    </div>

    <div class="box amarelo">
        <h3>2. Triagem (Chegou na cl√≠nica)</h3>
        <p>Colocar na fila de espera:</p>
        <input id="buscaNome" placeholder="Nome do Pet">
        <button onclick="porNaFila()">Entrar na Fila</button>
    </div>

    <div class="box roxo">
        <h3>3. Finalizar Atendimento (Cobrar)</h3>
        <p>Chamar paciente e liberar:</p>
        <input id="atendeNome" placeholder="Nome do Pet">
        <button onclick="finalizar()">Finalizar Consulta</button>
    </div>

    <div style="display: flex; gap: 20px;">
        <div style="flex: 1;">
            <h3>‚è≥ Fila de Espera (Aguardando)</h3>
            <ul id="listaFila"></ul>
        </div>
        
        <div style="flex: 1; color: gray;">
            <h3>‚úÖ Atendidos (Hist√≥rico do Dia)</h3>
            <ul id="listaHistorico"></ul>
        </div>
    </div>

    <script>
        // --- FUN√á√ÉO VISUAL (Interface do Usu√°rio) ---
    // Esta fun√ß√£o muda as op√ß√µes do segundo menu (<select>) dependendo do que foi escolhido no primeiro.
    function mudarOpcaoExtra() {
        // 1. Pega o valor do primeiro menu (se √© 'cao' ou 'gato')
        let tipo = document.getElementById("cadTipo").value;
        // 2. Pega o elemento HTML do segundo menu (onde vamos injetar as op√ß√µes)
        let extra = document.getElementById("cadExtra");
        
        // 3. Limpa qualquer op√ß√£o antiga para n√£o duplicar
        extra.innerHTML = "";

        // 4. Se for Cachorro, cria as op√ß√µes de Porte (Pequeno/Grande)
        if(tipo === "cao") {
            extra.innerHTML = '<option value="P">Porte Pequeno</option> <option value="G">Porte Grande</option>';
        } 
        // 5. Se for Gato, cria as op√ß√µes de Temperamento (Manso/Bravo)
        else {
            extra.innerHTML = '<option value="manso">Manso</option><option value="bravo">Bravo</option>';
        }
    }

    // ==========================================================
    // 1. MODELOS (CLASSES)
    // Aqui definimos como os objetos "Animal", "Cachorro" e "Gato" s√£o estruturados.
    // ==========================================================

    // CLASSE M√ÉE (Gen√©rica)
    class Animal {
        // Construtor: O m√©todo que roda automaticamente ao dar 'new Animal()'
        constructor(nome) { 
            this.nome = nome; // Guarda o nome do pet
        }
    }

    // CLASSE FILHA: Cachorro (Herda de Animal)
    class Cachorro extends Animal {
        constructor(nome, porte) { 
            super(nome); // Chama o construtor da M√£e (Animal) para salvar o nome
            this.tipo = "Cachorro"; // Define um "r√≥tulo" fixo
            this.porte = porte;     // Salva se √© 'P' ou 'G'
        }
        
        // M√©todo exclusivo: Calcula pre√ßo baseado no porte
        calcularPreco() { 
            // Operador tern√°rio: Se porte for "G", retorna 80. Sen√£o, retorna 50.
            return (this.porte === "G") ? 80 : 50; 
        }
    }

    // CLASSE FILHA: Gato (Herda de Animal)
    class Gato extends Animal {
        constructor(nome, temp) { 
            super(nome); // Chama o construtor da M√£e
            this.tipo = "Gato"; 
            this.temperamento = temp; // Salva se √© 'manso' ou 'bravo'
        }

        // M√©todo exclusivo: Calcula pre√ßo baseado no temperamento
        calcularPreco() { 
            // Gato bravo √© mais caro (risco de arranh√£o/seda√ß√£o)
            return (this.temperamento === "bravo") ? 90 : 40; 
        }
    }

    // ==========================================================
    // 2. SISTEMA (GERENTE DA CL√çNICA)
    // Aqui est√° a l√≥gica que controla as listas e o fluxo de trabalho.
    // ==========================================================
    class Clinica {
        fichas = [];      // LISTA 1 (Banco de Dados): Todos os animais cadastrados na hist√≥ria.
        filaEspera = [];  // LISTA 2 (Ativa): Quem chegou e est√° esperando atendimento AGORA.
        historico = [];   // LISTA 3 (Finalizado): Quem j√° foi atendido e pagou.

        // --- FUNCIONALIDADE A: CADASTRAR (Criar Ficha) ---
        cadastrar(animal) {
            // Adiciona o objeto animal na lista de fichas
            this.fichas.push(animal);
            alert(`Ficha do ${animal.nome} criada!`);
        }

        // --- FUNCIONALIDADE B: TRIAGEM (Colocar na Fila) ---
        triagem(nomeBuscado) {
            // 1. Busca na lista de fichas se o animal existe
            let paciente = this.fichas.find(p => p.nome === nomeBuscado);
            
            // Se n√£o achar (undefined), avisa erro e para a fun√ß√£o
            if (!paciente) { alert("Paciente sem ficha!"); return; }

            // 2. Valida√ß√£o: Verifica se ele J√Å est√° na fila para n√£o duplicar
            if(this.filaEspera.includes(paciente)) { alert("J√° est√° na fila!"); return; }

            // 3. Adiciona na fila de espera
            this.filaEspera.push(paciente);
            
            // 4. Atualiza a tela (HTML)
            this.atualizarTela();
        }

        // --- FUNCIONALIDADE C: FINALIZAR ATENDIMENTO (Cobrar e Arquivar) ---
        finalizarAtendimento(nomeBuscado) {
            // 1. Procura em qual posi√ß√£o (√≠ndice) da fila esse animal est√°
            let index = this.filaEspera.findIndex(p => p.nome === nomeBuscado);
            
            // Se index for -1, significa que n√£o achou
            if (index === -1) { alert("Este animal n√£o est√° na fila."); return; }

            // 2. Recupera o objeto do animal usando o √≠ndice
            let paciente = this.filaEspera[index];

            // 3. Cria o registro final (o "Recibo")
            let registro = {
                animal: paciente,  // O objeto do pet
                hora: new Date(),  // A hora que acabou
                valor: paciente.calcularPreco() // AQUI A M√ÅGICA: O sistema pede pro animal calcular seu pr√≥prio pre√ßo.
                                                // Se for Cachorro, roda a l√≥gica de Cachorro. Se for Gato, roda a de Gato.
            };

            // 4. Move esse registro para a lista de Hist√≥rico (Arquivo Morto)
            this.historico.push(registro);

            // 5. Remove o animal da Fila de Espera (usando splice)
            this.filaEspera.splice(index, 1);

            // 6. Avisa o valor e atualiza a tela
            alert(`Atendimento finalizado! Valor: R$ ${registro.valor.toFixed(2)}`);
            this.atualizarTela();
        }

        // --- ATUALIZAR TELA (Desenhar o HTML) ---
        atualizarTela() {
            let listaF = document.getElementById("listaFila");     // Pega a lista <ul> da Fila
            let listaH = document.getElementById("listaHistorico");// Pega a lista <ul> do Hist√≥rico
            
            // Limpa as listas antes de redesenhar
            listaF.innerHTML = ""; 
            listaH.innerHTML = "";

            // Loop 1: Desenha quem est√° na Fila
            this.filaEspera.forEach(p => {
                listaF.innerHTML += `<li>‚è≥ ${p.nome} (${p.tipo})</li>`;
            });

            // Loop 2: Desenha o Hist√≥rico
            this.historico.forEach(reg => {
                listaH.innerHTML += `
                    <li>
                        ‚úÖ <strong>${reg.animal.nome}</strong> - R$ ${reg.valor.toFixed(2)}
                        <br><small>Hora: ${reg.hora.toLocaleTimeString()}</small>
                    </li>`;
            });
        }
    }

    // ==========================================================
    // 3. INICIALIZA√á√ÉO (LIGAR O MOTOR)
    // ==========================================================
    
    // Cria a cl√≠nica na mem√≥ria
    const sistema = new Clinica();

    // Fun√ß√£o do Bot√£o "Salvar Ficha"
    function cadastrarFicha() {
        // Pega os dados dos inputs
        let nome = document.getElementById("cadNome").value;
        let tipo = document.getElementById("cadTipo").value;
        let extra = document.getElementById("cadExtra").value; // Esse valor muda (P/G ou manso/bravo)

        // Decide qual classe criar
        if(tipo === "cao") {
            sistema.cadastrar(new Cachorro(nome, extra)); // Cria Cachorro
        } else {
            sistema.cadastrar(new Gato(nome, extra));     // Cria Gato
        }
    }

    // Fun√ß√£o do Bot√£o "Entrar na Fila"
    function porNaFila() {
        let nome = document.getElementById("buscaNome").value;
        sistema.triagem(nome); // Manda pra triagem
        document.getElementById("buscaNome").value = ""; // Limpa campo
    }

    // Fun√ß√£o do Bot√£o "Finalizar Consulta"
    function finalizar() {
        let nome = document.getElementById("atendeNome").value;
        sistema.finalizarAtendimento(nome); // Finaliza
        document.getElementById("atendeNome").value = ""; // Limpa campo
    }
    </script>
</body>
</html>