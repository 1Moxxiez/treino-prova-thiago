<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Biblioteca com Hist√≥rico</title>
    <style>
        /* ESTILOS (CSS) - Apenas para deixar bonito com as cores */
        body { font-family: sans-serif; padding: 20px; }
        .box { padding: 15px; border: 2px solid; margin-bottom: 15px; border-radius: 8px; }
        .azul { border-color: #007bff; background-color: #f0f8ff; }
        .verde { border-color: #28a745; background-color: #f0fff4; }
        .vermelho { border-color: #dc3545; background-color: #fff0f1; }
        h3 { margin-top: 0; }
        ul { border-bottom: 1px solid #ccc; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h1>üìö Sistema Completo de Biblioteca</h1>
    
    <div class="box azul">
        <h3>1. Cadastrar Novo Item</h3>
        <select id="tipoCadastro">
            <option value="livro">Livro</option>
            <option value="revista">Revista</option>
        </select>
        <input id="cadTitulo" placeholder="T√≠tulo">
        <input id="cadAutor" placeholder="Autor">
        <button onclick="botaoCadastrar()">Salvar</button>
    </div>

    <div class="box verde">
        <h3>2. Emprestar (Sa√≠da)</h3>
        <p>Digite o nome do livro para emprestar:</p>
        <input id="buscaTitulo" placeholder="T√≠tulo do livro">
        <button onclick="botaoEmprestar()">Registrar Sa√≠da</button>
    </div>

    <div class="box vermelho">
        <h3>3. Devolver (Entrada)</h3>
        <p>Digite o nome do livro que voltou:</p>
        <input id="devolveTitulo" placeholder="T√≠tulo do livro">
        <button onclick="botaoDevolver()">Registrar Devolu√ß√£o</button>
    </div>

    <div style="display: flex; gap: 20px;">
        <div style="flex: 1;">
            <h3>üî¥ Emprestados (Atuais)</h3>
            <ul id="listaEmprestados"></ul>
        </div>
        
        <div style="flex: 1; color: gray;">
            <h3>‚úÖ Hist√≥rico (J√° Devolvidos)</h3>
            <ul id="listaHistorico"></ul>
        </div>
    </div>

    <script>
        // ==========================================================
        // 1. MODELOS (Classes que definem o que √© um Livro ou Revista)
        // ==========================================================
        
        // Classe PAI: Define atributos que todo item tem (T√≠tulo e Autor)
        class ItemAcervo {
            constructor(titulo, autor) {
                this.titulo = titulo;
                this.autor = autor;
            }
        }

        // Classe FILHA: Livro. Herda de ItemAcervo.
        class Livro extends ItemAcervo {
            constructor(titulo, autor) { 
                super(titulo, autor); // 'super' chama o construtor do pai para salvar titulo e autor
                this.tipo = "Livro";  // Adiciona uma "etiqueta" dizendo que √© livro
            }
        }

        // Classe FILHA: Revista. Herda de ItemAcervo.
        class Revista extends ItemAcervo {
            constructor(titulo, autor) { 
                super(titulo, autor); 
                this.tipo = "Revista"; // Adiciona etiqueta de revista
            }
        }
    
        // ==========================================================
        // 2. O SISTEMA (A L√≥gica da Biblioteca)
        // ==========================================================
        class Biblioteca {
            acervo = [];      // LISTA 1: A estante. Onde ficam os itens cadastrados.
            emprestados = []; // LISTA 2: Itens ativos. Quem est√° com o livro AGORA.
            historico = [];   // LISTA 3: Arquivo morto. Itens que j√° foram devolvidos.
    
            // --- M√âTODO A: CADASTRAR (Adicionar na estante) ---
            cadastrarItem(item) {
                // Verifica se j√° existe um item com esse t√≠tulo na estante
                let existe = this.acervo.find(i => i.titulo === item.titulo);
                
                // Se existe, para o c√≥digo e avisa.
                if(existe) { alert("J√° cadastrado!"); return; }
    
                // Se n√£o existe, adiciona na lista do acervo
                this.acervo.push(item);
                alert("Cadastrado com sucesso!");
            }
    
            // --- M√âTODO B: EMPRESTAR (Registrar sa√≠da) ---
            registrarEmprestimo(tituloBuscado) {
                // 1. Procura se o livro existe na estante (acervo)
                let itemNoAcervo = this.acervo.find(i => i.titulo === tituloBuscado);
                
                // Se n√£o achar (undefined), avisa erro.
                if (!itemNoAcervo) { alert("Livro n√£o existe no acervo!"); return; }

                // 2. Procura se esse livro J√Å EST√Å na lista de emprestados
                let jaEmprestado = this.emprestados.find(r => r.item.titulo === tituloBuscado);
                
                // Se j√° estiver emprestado, impede a a√ß√£o.
                if (jaEmprestado) { alert("Livro j√° est√° emprestado!"); return; }
    
                // 3. Cria o "Ticket" de empr√©stimo
                let registro = {
                    item: itemNoAcervo,   // Guarda o objeto do livro inteiro
                    dataSaida: new Date(), // Marca a hora de agora como sa√≠da
                    dataVolta: null        // Volta √© null porque ainda n√£o voltou
                };
    
                // Adiciona na lista de ativos (emprestados)
                this.emprestados.push(registro);
                
                // Atualiza o HTML
                this.atualizarTela();
            }

            // --- M√âTODO C: DEVOLVER (Mover para hist√≥rico) ---
            registrarDevolucao(tituloBuscado) {
                // 1. Procura O √çNDICE (a posi√ß√£o n√∫mero 0, 1, 2...) do empr√©stimo na lista de ativos
                // Usamos findIndex porque precisamos saber ONDE ele est√° para remover depois.
                let index = this.emprestados.findIndex(reg => reg.item.titulo === tituloBuscado);

                // Se retornar -1, significa que n√£o achou ningu√©m com esse livro na lista de ativos.
                if (index === -1) { alert("N√£o encontrei esse empr√©stimo ativo."); return; }

                // 2. Pega o registro do empr√©stimo usando o √≠ndice que achamos
                let emprestimo = this.emprestados[index];

                // 3. Atualiza a data de volta para "agora"
                emprestimo.dataVolta = new Date();

                // 4. Move o objeto para a lista de HIST√ìRICO (para ficar salvo para sempre)
                this.historico.push(emprestimo);

                // 5. Remove o objeto da lista de EMPRESTADOS (Ativos)
                // .splice(posicao, quantidade) -> remove 1 item a partir daquela posi√ß√£o
                this.emprestados.splice(index, 1);

                alert("Devolvido e arquivado no hist√≥rico!");
                this.atualizarTela();
            }
    
            // --- M√âTODO D: ATUALIZAR TELA (DOM) ---
            atualizarTela() {
                // Pega os elementos <ul> do HTML
                let listaE = document.getElementById("listaEmprestados");
                let listaH = document.getElementById("listaHistorico");
                
                // Limpa o conte√∫do atual deles
                listaE.innerHTML = ""; 
                listaH.innerHTML = ""; 
                
                // LOOP 1: Preenche a lista de Emprestados (Ativos)
                this.emprestados.forEach(reg => {
                    listaE.innerHTML += `<li>üìñ <strong>${reg.item.titulo}</strong> <br><small>Saiu √†s: ${reg.dataSaida.toLocaleTimeString()}</small></li>`;
                });

                // LOOP 2: Preenche a lista de Hist√≥rico (Devolvidos)
                this.historico.forEach(reg => {
                    listaH.innerHTML += `
                        <li>
                            ‚úÖ <strong>${reg.item.titulo}</strong>
                            <br>
                            <small>Saiu: ${reg.dataSaida.toLocaleTimeString()} | Voltou: ${reg.dataVolta.toLocaleTimeString()}</small>
                        </li>`;
                });
            }
        }
    
        // ==========================================================
        // 3. INICIALIZA√á√ÉO (Liga√ß√£o com Bot√µes)
        // ==========================================================
        
        // Cria o sistema na mem√≥ria
        const sistema = new Biblioteca();
    
        // Fun√ß√£o do Bot√£o "Salvar"
        function botaoCadastrar() {
            let tipo = document.getElementById("tipoCadastro").value;
            let tit = document.getElementById("cadTitulo").value;
            let aut = document.getElementById("cadAutor").value;
            
            // Verifica o tipo e cria o objeto certo (Livro ou Revista)
            if(tipo === "livro") sistema.cadastrarItem(new Livro(tit, aut));
            else sistema.cadastrarItem(new Revista(tit, aut));
            
            // Limpa os campos de texto
            document.getElementById("cadTitulo").value = "";
            document.getElementById("cadAutor").value = "";
        }
    
        // Fun√ß√£o do Bot√£o "Registrar Sa√≠da"
        function botaoEmprestar() {
            let busca = document.getElementById("buscaTitulo").value;
            sistema.registrarEmprestimo(busca);
            document.getElementById("buscaTitulo").value = ""; // Limpa campo
        }

        // Fun√ß√£o do Bot√£o "Registrar Devolu√ß√£o"
        function botaoDevolver() {
            let busca = document.getElementById("devolveTitulo").value;
            sistema.registrarDevolucao(busca);
            document.getElementById("devolveTitulo").value = ""; // Limpa campo
        }
    </script>
</body>
</html>